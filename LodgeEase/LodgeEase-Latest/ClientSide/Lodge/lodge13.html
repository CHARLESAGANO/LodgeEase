<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ever Lodge - LodgeEase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../Homepage/styles.css">
  <!-- Add jQuery UI CSS -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
  <!-- Add jQuery and jQuery UI -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <script src="../components/messagePopup.js"></script>
  <script>
    // Initialize Google Map
    function initMap() {
      // Get the map container element
      const mapElement = document.getElementById('lodge-map');
      
      // Only initialize if the element exists
      if (mapElement) {
        const lodgeLocation = { lat: 16.4088, lng: 120.6013 }; // Ever Lodge coordinates in Baguio
        const map = new google.maps.Map(mapElement, {
          center: lodgeLocation,
          zoom: 15,
          styles: [
            {
              featureType: 'poi',
              elementType: 'labels',
              stylers: [{ visibility: 'off' }]
            }
          ]
        });

        const marker = new google.maps.Marker({
          position: lodgeLocation,
          map: map,
          title: 'Ever Lodge'
        });

        const infoWindow = new google.maps.InfoWindow({
          content: '<div class="p-2"><strong>Ever Lodge</strong><br>Your modern retreat in the heart of Baguio</div>'
        });

        marker.addListener('click', () => {
          infoWindow.open(map, marker);
        });
      } else {
        console.warn('Map container element not found. Map initialization skipped.');
      }
    }
    
    // Make sure DOM is loaded before initializing map
    document.addEventListener('DOMContentLoaded', () => {
      // Now it's safe to load the Google Maps script
      if (!window.google || !window.google.maps) {
        const script = document.createElement('script');
        script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyAaKZC47lvxIv0ej9bECXhUyaoL3FYuDM8&callback=initMap";
        script.async = true;
        script.defer = true;
        document.head.appendChild(script);
      } else {
        // If Google Maps is already loaded
        initMap();
      }
    });
  </script>
  <style>
    /* Fix for header overlap issue */
    body {
      padding-top: 0; /* Remove top padding */
      overflow-y: auto !important; /* Force vertical scrolling */
      margin: 0;
    }
    
    /* Fixed header styling to avoid content overlap */
    .main-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 50;
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(8px);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      height: 72px; /* Set explicit height */
    }
    
    /* Add proper spacing for content below fixed header */
    .content-container {
      padding-top: 80px; /* Adjust based on header height */
    }
    
    /* Ensure modals work properly */
    #gallery-modal {
      overflow-y: auto;
    }

    .toggle-checkbox:checked {
      right: 0;
      border-color: #4B91F1;
    }
    .toggle-checkbox:checked + .toggle-label {
      background-color: #4B91F1;
    }
    .toggle-label {
      transition: background-color 0.3s ease;
    }
    .toggle-checkbox {
      transition: all 0.3s ease;
      left: 0;
    }
    
    /* Night promo popup styling */
    #night-promo-popup {
      transition: all 0.3s ease;
      border-left-width: 4px;
    }
    
    #night-promo-popup.animate-pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(52, 211, 153, 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(52, 211, 153, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(52, 211, 153, 0);
      }
    }
    
    /* Time selection styling */
    select#check-in-time, select#check-out-time {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
  </style>
</head>

<body class="text-gray-800">
  <header class="main-header">
    <nav class="container mx-auto h-full px-4 lg:px-6 flex items-center justify-between">
      <!-- Logo -->
      <a href="../Homepage/rooms.html" class="logo flex items-center space-x-2">
        <img src="../components/LodgeEaseLogo.png" alt="LodgeEase" class="h-12">
      </a>

      <!-- Navigation Links -->
      <div class="flex items-center space-x-4">
        <a href="../Homepage/rooms.html" class="nav-button active" title="Go to homepage">
          <i class="ri-home-line"></i>
          <span>Home</span>
        </a>
        <button id="loginButton" class="nav-button">
          <i class="ri-login-box-line"></i>
          <span>Log in</span>
        </button>
        <button id="userIconBtn" class="menu-button">
          <i class="ri-menu-line"></i>
          <i class="ri-user-line"></i>
        </button>
      </div>
    </nav>
  </header>

  <!-- Remove the drawer overlay -->
  <!-- 
  <div id="drawerOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40"></div>
   -->

  <div id="userDrawer" class="fixed top-0 right-0 w-80 h-full bg-white shadow-xl transform transition-transform duration-300 z-50 translate-x-full">
    <button id="closeDrawer" class="absolute top-4 right-4 text-gray-600 hover:text-gray-900">
      <i class="ri-close-line text-2xl"></i>
    </button>
    <div class="drawer-content p-6">
        <!-- Content will be dynamically inserted by JavaScript -->
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-container max-w-6xl mx-auto px-4">
    <!-- Title -->
    <h1 class="text-2xl font-bold mb-4">Ever Lodge</h1>

    <!-- Main content grid -->
    <div class="grid md:grid-cols-3 gap-4">
      <!-- Left Section: Images -->
      <div class="md:col-span-2">
        <div class="relative">
          <div class="grid grid-cols-2 gap-2">
            <img src="../components/6.jpg" alt="Main Image" class="rounded-lg object-cover w-full h-64 md:h-96 col-span-2 cursor-pointer" onclick="openGallery(0)">
            <img src="../components/7.jpg" alt="Image 1" class="rounded-lg object-cover w-full h-32 cursor-pointer" onclick="openGallery(1)">
            <img src="../components/8.jpg" alt="Image 2" class="rounded-lg object-cover w-full h-32 cursor-pointer" onclick="openGallery(2)">
            <img src="../components/9.jpg" alt="Image 3" class="rounded-lg object-cover w-full h-32 cursor-pointer" onclick="openGallery(3)">
            <img src="../components/10.jpg" alt="Image 4" class="rounded-lg object-cover w-full h-32 cursor-pointer" onclick="openGallery(4)">
          </div>
          <button onclick="openGallery(0)" class="absolute bottom-4 right-4 bg-white text-gray-800 px-4 py-2 rounded-lg shadow-md hover:bg-gray-100 transition-colors flex items-center space-x-2">
            <i class="fas fa-images"></i>
            <span>View all photos</span>
          </button>
        </div>
      </div>

      <!-- Right Section: Booking and Pricing -->
      <div class="bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-lg font-semibold mb-2">Book your stay</h2>
        
        <!-- Promo Banner -->
        <div id="promo-banner" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-lg mb-4 shadow-sm hidden">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <i class="fas fa-tag mr-2"></i>
              <span class="font-medium text-sm">Night Promo Available</span>
            </div>
            <span class="text-sm font-bold">â‚±580</span>
          </div>
          <p class="text-xs mt-1 text-green-50">For 1-night stays: Check-in at night (10PM-8AM)</p>
        </div>
        
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Check-in</label>
            <input id="check-in-date" type="text" readonly class="block w-full border border-gray-300 rounded-md p-2 bg-white cursor-pointer mb-2" placeholder="Add date">
            <select id="check-in-time" class="block w-full border border-gray-300 rounded-md p-2">
              <option value="" disabled selected>Select time</option>
              <option value="00:00">12:00 AM</option>
              <option value="01:00">1:00 AM</option>
              <option value="02:00">2:00 AM</option>
              <option value="03:00">3:00 AM</option>
              <option value="04:00">4:00 AM</option>
              <option value="05:00">5:00 AM</option>
              <option value="06:00">6:00 AM</option>
              <option value="07:00">7:00 AM</option>
              <option value="08:00">8:00 AM</option>
              <option value="09:00">9:00 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="12:00">12:00 PM</option>
              <option value="13:00">1:00 PM</option>
              <option value="14:00">2:00 PM</option>
              <option value="15:00">3:00 PM</option>
              <option value="16:00">4:00 PM</option>
              <option value="17:00">5:00 PM</option>
              <option value="18:00">6:00 PM</option>
              <option value="19:00">7:00 PM</option>
              <option value="20:00">8:00 PM</option>
              <option value="21:00">9:00 PM</option>
              <option value="22:00">10:00 PM</option>
              <option value="23:00">11:00 PM</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Checkout</label>
            <input id="check-out-date" type="text" readonly class="block w-full border border-gray-300 rounded-md p-2 bg-white cursor-pointer mb-2" placeholder="Add date">
            <select id="check-out-time" class="block w-full border border-gray-300 rounded-md p-2">
              <option value="" disabled selected>Select time</option>
              <option value="00:00">12:00 AM</option>
              <option value="01:00">1:00 AM</option>
              <option value="02:00">2:00 AM</option>
              <option value="03:00">3:00 AM</option>
              <option value="04:00">4:00 AM</option>
              <option value="05:00">5:00 AM</option>
              <option value="06:00">6:00 AM</option>
              <option value="07:00">7:00 AM</option>
              <option value="08:00">8:00 AM</option>
              <option value="09:00">9:00 AM</option>
              <option value="10:00">10:00 AM</option>
              <option value="11:00">11:00 AM</option>
              <option value="12:00">12:00 PM</option>
              <option value="13:00">1:00 PM</option>
              <option value="14:00">2:00 PM</option>
              <option value="15:00">3:00 PM</option>
              <option value="16:00">4:00 PM</option>
              <option value="17:00">5:00 PM</option>
              <option value="18:00">6:00 PM</option>
              <option value="19:00">7:00 PM</option>
              <option value="20:00">8:00 PM</option>
              <option value="21:00">9:00 PM</option>
              <option value="22:00">10:00 PM</option>
              <option value="23:00">11:00 PM</option>
            </select>
          </div>
        </div>
        
        <!-- Night Promo Popup -->
        <div id="night-promo-popup" class="hidden bg-green-100 border-l-4 border-green-500 p-4 mb-4 rounded-md">
          <div class="flex items-center">
            <div class="flex-shrink-0 text-green-600 mr-3">
              <i class="fas fa-moon text-2xl"></i>
            </div>
            <div class="flex-1">
              <p class="font-bold text-green-800 text-base">Night Owl Special: â‚±580/night!</p>
              <p class="text-sm text-green-700 mt-1">Your booking qualifies for our special rate with check-in at 10:00 PM and check-out between 3:00 AM and 8:00 AM</p>
              <div class="mt-2 flex flex-wrap gap-2">
                <span class="text-xs px-2 py-1 bg-green-200 text-green-800 rounded-full">Night Promo Applied</span>
                <span class="text-xs px-2 py-1 bg-green-200 text-green-800 rounded-full">Save â‚±720</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Hidden input to store the rate type value -->
        <input type="hidden" id="rate-type-value" value="standard">
        
        <!-- Hourly rate selection (hidden by default) -->
        <div id="hourly-options" class="mt-3 hidden">
          <label class="block text-sm font-medium text-gray-700 mb-2">Select Hours</label>
          <select id="hourly-duration" class="block w-full border border-gray-300 rounded-md p-2">
            <option value="2">2 hours - â‚±320</option>
            <option value="3">3 hours - â‚±380</option>
            <option value="4">4 hours - â‚±440</option>
            <option value="5">5 hours - â‚±500</option>
            <option value="6">6 hours - â‚±560</option>
            <option value="7">7 hours - â‚±620</option>
            <option value="8">8 hours - â‚±680</option>
            <option value="9">9 hours - â‚±740</option>
            <option value="10">10 hours - â‚±800</option>
            <option value="11">11 hours - â‚±820</option>
            <option value="12">12 hours - â‚±820</option>
            <option value="13">13 hours - â‚±880</option>
            <option value="14">14-24 hours - â‚±940</option>
          </select>
        </div>
        
        <label class="block text-sm font-medium text-gray-700 mb-2">Guests</label>
        <select id="guests" class="block w-full border border-gray-300 rounded-md p-2 mb-4">
          <option value="1">1 guest</option>
          <option value="2">2 guests</option>
          <option value="3">3 guests</option>
          <option value="4">4 guests</option>
        </select>
        <div class="form-group mb-4">
            <label for="guest-contact" class="block text-sm font-medium text-gray-700 mb-2">Contact Number:</label>
            <input 
                type="tel" 
                id="guest-contact" 
                class="block w-full border border-gray-300 rounded-md p-2" 
                required 
                pattern="[0-9]+" 
                minlength="11" 
                maxlength="11" 
                placeholder="Enter your contact number"
            >
            <div id="contact-error" class="text-red-500 text-sm hidden mt-1">Please enter a valid 11-digit phone number</div>
        </div>
        <div class="booking-button-container">
            <button 
                id="reserve-btn" 
                type="button"
                data-clicked="false"
                onclick="try { (window.reserveClickFallback || window.emergencyReserveClickFallback)(event); } catch(e) { console.error('All fallbacks failed:', e); alert('Reservation system is currently unavailable. Please try again later.'); this.disabled = false; this.textContent = 'Reserve'; }"
                class="w-full bg-blue-500 text-white py-2 rounded-md font-medium hover:bg-blue-600 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
            >
                Reserve
            </button>
        </div>        

        <!-- Pricing Details -->
        <div id="pricing-details" class="mt-4 hidden">
          <p class="flex justify-between">
            <span id="nights-calculation">â‚±1,300 x 5 nights</span>
            <span id="total-nights-price">â‚±6,500</span>
          </p>
          <p class="flex justify-between" id="promo-discount-row" class="hidden">
            <span>Night Promo Discount</span>
            <span id="promo-discount" class="text-green-600">-â‚±0</span>
          </p>
          <p class="flex justify-between">
            <span>Service fee</span>
            <span id="service-fee">â‚±910</span>
          </p>
          <hr class="my-2">
          <p class="flex justify-between font-bold">
            <span>Total before taxes</span>
            <span id="total-price">â‚±7,410</span>
          </p>
        </div>
        
        <!-- Best Value Badge -->
        <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3 flex items-center space-x-2">
          <i class="fas fa-award text-blue-500"></i>
          <div>
            <p class="font-medium text-blue-800">Best Value in Baguio</p>
            <p class="text-xs text-blue-600">Top-rated location with modern amenities</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Photo Gallery Modal -->
    <div id="gallery-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
      <div class="h-full w-full flex flex-col">
        <!-- Gallery Header -->
        <div class="p-4 flex justify-between items-center text-white">
          <span class="text-lg" id="gallery-counter">1 / 5</span>
          <button onclick="closeGallery()" class="text-2xl hover:text-gray-300">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <!-- Gallery Content -->
        <div class="flex-1 flex items-center justify-center relative">
          <button onclick="prevImage()" class="absolute left-4 text-white text-4xl hover:text-gray-300">
            <i class="fas fa-chevron-left"></i>
          </button>
          
          <div class="relative w-full h-full flex items-center justify-center">
            <img id="gallery-image" src="../components/6.jpg" alt="Gallery image" class="max-h-[80vh] max-w-[80vw] object-contain">
          </div>
          
          <button onclick="nextImage()" class="absolute right-4 text-white text-4xl hover:text-gray-300">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        
        <!-- Thumbnails -->
        <div class="p-4 flex justify-center space-x-2">
          <img src="../components/6.jpg" onclick="showImage(0)" class="w-16 h-16 object-cover cursor-pointer rounded gallery-thumb">
          <img src="../components/7.jpg" onclick="showImage(1)" class="w-16 h-16 object-cover cursor-pointer rounded gallery-thumb">
          <img src="../components/8.jpg" onclick="showImage(2)" class="w-16 h-16 object-cover cursor-pointer rounded gallery-thumb">
          <img src="../components/9.jpg" onclick="showImage(3)" class="w-16 h-16 object-cover cursor-pointer rounded gallery-thumb">
          <img src="../components/10.jpg" onclick="showImage(4)" class="w-16 h-16 object-cover cursor-pointer rounded gallery-thumb">
        </div>
      </div>
    </div>

    <!-- Location & Amenities Section -->
    <div class="max-w-5xl mx-auto mt-12 p-6 bg-white rounded-lg shadow-lg">
      <h2 class="text-2xl font-bold mb-6">Location & Amenities</h2>
      
      <div class="grid md:grid-cols-2 gap-8">
        <!-- Map Section -->
        <div>
          <!-- Add the map container here -->
          <div id="lodge-map" class="w-full h-80 rounded-lg mb-4"></div>
          <p class="text-gray-600">
            <i class="fas fa-map-marker-alt text-blue-500 mr-2"></i>
            Located in Baguio City, 5 minutes from SM Baguio
          </p>
          <div class="mt-4 space-y-2">
            <p class="text-gray-600">
              <i class="fas fa-walking text-blue-500 mr-2"></i>
              8 minutes walk to Session Road
            </p>
            <p class="text-gray-600">
              <i class="fas fa-car text-blue-500 mr-2"></i>
              10 minutes drive to Camp John Hay
            </p>
            <p class="text-gray-600">
              <i class="fas fa-shopping-bag text-blue-500 mr-2"></i>
              Near local markets and dining establishments
            </p>
          </div>
        </div>

        <!-- Amenities Section -->
        <div>
          <h3 class="text-xl font-semibold mb-4">What this place offers</h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="flex items-center space-x-3">
              <i class="fas fa-wifi text-blue-500"></i>
              <span>High-speed WiFi</span>
            </div>
            <div class="flex items-center space-x-3">
              <i class="fas fa-parking text-blue-500"></i>
              <span>Secured parking</span>
            </div>
            <div class="flex items-center space-x-3">
              <i class="fas fa-tv text-blue-500"></i>
              <span>65" Smart TV</span>
            </div>
            <div class="flex items-center space-x-3">
              <i class="fas fa-mountain text-blue-500"></i>
              <span>Mountain view</span>
            </div>
            <div class="flex items-center space-x-3">
              <i class="fas fa-utensils text-blue-500"></i>
              <span>Modern kitchen</span>
            </div>
            <div class="flex items-center space-x-3">
              <i class="fas fa-snowflake text-blue-500"></i>
              <span>Heating system</span>
            </div>
            <div class="flex items-center space-x-3">
              <i class="fas fa-dumbbell text-blue-500"></i>
              <span>Fitness center</span>
            </div>
            <div class="flex items-center space-x-3">
              <i class="fas fa-coffee text-blue-500"></i>
              <span>Coffee shop</span>
            </div>
          </div>

          <div class="mt-6">
            <h3 class="text-xl font-semibold mb-4">House rules</h3>
            <div class="space-y-2">
              <p class="flex items-center text-gray-600">
                <i class="fas fa-clock text-blue-500 mr-3"></i>
                Check-in: 1:00 PM - 6:00 PM
              </p>
              <p class="flex items-center text-gray-600">
                <i class="fas fa-sign-out-alt text-blue-500 mr-3"></i>
                Checkout: 12:00 PM
              </p>
              <p class="flex items-center text-gray-600">
                <i class="fas fa-smoking-ban text-blue-500 mr-3"></i>
                No smoking
              </p>
              <p class="flex items-center text-gray-600">
                <i class="fas fa-paw text-blue-500 mr-3"></i>
                Small pets allowed (with fee)
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- New Section: Special Offers -->
    <div class="max-w-5xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-lg">
      <h2 class="text-2xl font-bold mb-4">Special Offers</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Weekly Rate -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100">
          <div class="flex justify-between items-center">
            <h3 class="font-bold text-blue-800">Weekly Rate</h3>
            <span class="text-green-600 font-semibold">10% OFF</span>
          </div>
          <p class="text-sm text-gray-600 mt-2">Stay for 7+ nights and get 10% off the total price</p>
          <div class="mt-3 flex space-x-2">
            <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">Applied automatically</span>
          </div>
        </div>
        
        <!-- Night Promo Details -->
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-100">
          <div class="flex justify-between items-center">
            <h3 class="font-bold text-green-800">Night Owl Special</h3>
            <span class="text-green-600 font-semibold">â‚±580/night</span>
          </div>
          <p class="text-sm text-gray-600 mt-2">One-night stays with check-in at 10:00 PM and check-out between 3:00 AM and 8:00 AM</p>
          <div class="mt-3 flex space-x-2">
            <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">Limited availability</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Calendar -->
    <div id="calendar-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
      <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full relative">
        <button id="close-calendar" class="absolute top-4 right-4 text-gray-600 hover:text-gray-900">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
        <div class="flex justify-between items-center mb-6">
          <button id="prev-month" class="text-gray-600 hover:bg-gray-100 p-2 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <h2 id="calendar-month" class="text-xl font-semibold text-gray-800">January 2025</h2>
          <button id="next-month" class="text-gray-600 hover:bg-gray-100 p-2 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>

        <div id="calendar-grid" class="grid grid-cols-7 gap-2 text-center">
          <!-- Days will be dynamically populated here -->
        </div>

        <div class="mt-6 flex justify-between">
          <button id="clear-dates" class="text-blue-600 hover:underline">Clear dates</button>
          <div id="nights-selected" class="text-sm text-gray-600"></div>
        </div>
      </div>
    </div>

    <!-- Host Section with Expanded Layout -->
    <div class="bg-white rounded-lg shadow-lg p-8 max-w-5xl mx-auto mt-8 space-y-6">
      <div class="flex flex-col md:flex-row items-center space-y-6 md:space-y-0 md:space-x-8">
        <!-- Host Profile -->
        <div class="flex flex-col items-center md:items-start text-center md:text-left">
          <img src="../components/model2.jpg" alt="Host Profile" class="w-24 h-24 rounded-full object-cover shadow-md border-4 border-blue-100 mb-4">
          <p class="text-2xl font-bold text-gray-800">Michael</p>
          <div class="flex items-center space-x-2 mt-2">
            <span class="text-sm text-blue-600 bg-blue-100 px-3 py-1 rounded-full">Superhost</span>
            <span class="text-sm text-gray-500">4 Years Hosting</span>
          </div>
          <p class="text-sm text-gray-500 mt-2">Lives in Baguio City, Philippines</p>
        </div>

        <!-- Host Stats with Larger Ratings -->
        <div class="flex-grow w-full md:w-auto">
          <div class="bg-blue-50 rounded-lg p-6 text-center">
            <div class="flex items-center justify-center space-x-4 mb-4">
              <span class="text-5xl font-bold text-blue-600">4.98</span>
              <span class="text-yellow-500 text-3xl">â˜…â˜…â˜…â˜…â˜…</span>
            </div>
            <p class="text-sm text-gray-500 mb-4">42 Reviews</p>
            
            <div class="space-y-2">
              <p class="text-sm text-gray-700">
                <span class="font-bold text-green-600">98%</span> Response Rate
              </p>
              <p class="text-sm text-gray-700">Responds within 2 hours</p>
            </div>
          </div>
        </div>

        <!-- Message Host Button -->
        <div class="w-full md:w-auto">
          <button class="w-full bg-blue-500 text-white py-3 px-6 rounded-md font-semibold hover:bg-blue-600 transition-colors flex items-center justify-center space-x-2">
            <i class="fas fa-comment-dots"></i>
            <span class="text-base">Message Host</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Reviews Container -->
<div id="reviews-section" class="mt-8">
  <!-- Ratings Overview -->
  <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 mb-8">
      <div class="flex items-center space-x-6">
          <div class="text-center flex-shrink-0">
              <p class="text-5xl font-bold text-blue-600">5.0</p>
              <p class="text-gray-500 text-sm uppercase tracking-wider mt-2">Overall Rating</p>
          </div>
          
          <div class="grid grid-cols-2 gap-x-6 gap-y-3 text-sm w-full">
              <div class="flex justify-between items-center">
                  <span class="text-gray-800 font-medium">Cleanliness</span>
                  <div class="flex">
                      <span class="text-yellow-500 text-xl">â˜…â˜…â˜…â˜…â˜…</span>
                  </div>
              </div>
              <div class="flex justify-between items-center">
                  <span class="text-gray-800 font-medium">Accuracy</span>
                  <div class="flex">
                      <span class="text-yellow-500 text-xl">â˜…â˜…â˜…â˜…â˜…</span>
                  </div>
              </div>
              <div class="flex justify-between items-center">
                  <span class="text-gray-800 font-mdium">Check-in</span>
                  <div class="flex">
                      <span class="text-yellow-500 text-xl">â˜…â˜…â˜…â˜…â˜†</span>
                  </div>
              </div>
              <div class="flex justify-between items-center">
                  <span class="text-gray-800 font-medium">Communication</span>
                  <div class="flex">
                      <span class="text-yellow-500 text-xl">â˜…â˜…â˜…â˜…â˜†</span>
                  </div>
              </div>
              <div class="flex justify-between items-center">
                  <span class="text-gray-800 font-medium">Location</span>
                  <div class="flex">
                      <span class="text-yellow-500 text-xl">â˜…â˜…â˜…â˜…â˜…</span>
                  </div>
              </div>
              <div class="flex justify-between items-center">
                  <span class="text-gray-800 font-medium">Value</span>
                  <div class="flex">
                      <span class="text-yellow-500 text-xl">â˜…â˜…â˜…â˜…â˜…</span>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Posted Reviews List -->
  <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 mb-8">
      <h3 class="text-2xl font-bold mb-6">Reviews</h3>
      <div id="user-reviews-list" class="space-y-6">
          <!-- Loading indicator -->
          <div id="reviews-loading" class="text-center py-4">
              <i class="fas fa-spinner fa-spin text-blue-500 text-2xl"></i>
              <p class="text-gray-500 mt-2">Loading reviews...</p>
          </div>
      </div>
      <!-- No reviews message -->
      <div id="no-reviews" class="hidden text-center py-8 text-gray-500">
          <i class="fas fa-comment-slash text-4xl mb-3"></i>
          <p>No reviews yet. Be the first to leave a review!</p>
      </div>
  </div>

  <!-- Review Form Section -->
  <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-lg p-6 mb-8 mt-8">
    <h3 class="text-2xl font-bold mb-6">Leave a Review</h3>
    <form id="review-form" class="space-y-6">
      <!-- Star Rating -->
      <div class="mb-4">
        <label class="block text-gray-700 text-sm font-bold mb-2">Rating</label>
        <div class="flex space-x-2" id="star-rating">
          <i class="fas fa-star text-2xl cursor-pointer text-gray-300 hover:text-yellow-500" data-rating="1"></i>
          <i class="fas fa-star text-2xl cursor-pointer text-gray-300 hover:text-yellow-500" data-rating="2"></i>
          <i class="fas fa-star text-2xl cursor-pointer text-gray-300 hover:text-yellow-500" data-rating="3"></i>
          <i class="fas fa-star text-2xl cursor-pointer text-gray-300 hover:text-yellow-500" data-rating="4"></i>
          <i class="fas fa-star text-2xl cursor-pointer text-gray-300 hover:text-yellow-500" data-rating="5"></i>
        </div>
      </div>

      <!-- Review Text -->
      <div class="mb-4">
        <label for="review-text" class="block text-gray-700 text-sm font-bold mb-2">Your Review</label>
        <textarea
          id="review-text"
          class="w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-blue-500"
          rows="4"
          placeholder="Share your experience..."
          required
        ></textarea>
      </div>

      <!-- Submit Button -->
      <div class="text-center">
        <button
          type="submit"
          class="bg-blue-500 text-white px-8 py-2 rounded-md hover:bg-blue-600 transition-colors"
        >
          Submit Review
        </button>
      </div>
    </form>
  </div>
</div>

  <!-- File Checker - Add before other scripts -->
  <script type="module">
    // First try to load the file checker to detect missing files
    try {
      const { fileCheckResults } = await import('./fileChecker.js');
      // Wait for the check to complete
      const results = await fileCheckResults;
      
      // If critical files are missing, alert the user
      if (!results.canProceed) {
        console.error('Critical files are missing:', results.report);
        alert('The reservation system may not work properly due to missing files. Please contact support if you cannot make a reservation.');
      }
    } catch (error) {
      console.error('Failed to load file checker:', error);
    }
  </script>

  <script type="module">
    // Add error handling for module imports
    let handleReserveClick, initializeBookingsModal, showBookingsModal, initializeUserDrawer;
    let auth, db;
    
    // Try to import modules with error handling
    try {
      const lodgeModule = await import('./lodge13.js').catch(e => {
        console.error('Failed to import lodge13.js:', e);
        return null;
      });
      
      if (lodgeModule) {
        // Extract functions if module loaded successfully
        handleReserveClick = lodgeModule.handleReserveClick;
        initializeBookingsModal = lodgeModule.initializeBookingsModal;
        showBookingsModal = lodgeModule.showBookingsModal;
        console.log('Successfully imported lodge13.js module');
      } else {
        console.error('lodge13.js module is null or undefined');
      }
    } catch (error) {
      console.error('Error importing lodge13.js module:', error);
    }
    
    try {
      const drawerModule = await import('../components/userDrawer.js').catch(e => {
        console.error('Failed to import userDrawer.js:', e);
        return null;
      });
      
      if (drawerModule) {
        initializeUserDrawer = drawerModule.initializeUserDrawer;
        console.log('Successfully imported userDrawer.js module');
      } else {
        console.error('userDrawer.js module is null or undefined');
      }
    } catch (error) {
      console.error('Error importing userDrawer.js module:', error);
    }
    
    try {
      const firebaseModule = await import('../../AdminSide/firebase.js').catch(e => {
        console.error('Failed to import firebase.js:', e);
        return null;
      });
      
      if (firebaseModule) {
        auth = firebaseModule.auth;
        db = firebaseModule.db;
        console.log('Successfully imported firebase.js module');
      } else {
        console.error('firebase.js module is null or undefined');
      }
    } catch (error) {
      console.error('Error importing firebase.js module:', error);
    }
    
    // Debug Firebase initialization
    console.log('DEBUG: Firebase auth available:', !!auth);
    console.log('DEBUG: Firebase db available:', !!db);
    
    // Add fallback function for direct button access
    window.reserveClickFallback = async function(event) {
      console.log('DEBUG: Reserve button fallback function called');
      try {
        const button = document.getElementById('reserve-btn');
        if (button && (button.getAttribute('data-clicked') === 'true' || button.disabled)) {
          console.log('DEBUG: Button already clicked via fallback, preventing duplicate');
          return;
        }
        
        if (button) {
          button.setAttribute('data-clicked', 'true');
          button.disabled = true;
          button.textContent = 'Processing...';
          button.classList.add('bg-gray-500');
        }
        
        // Call the module function
        if (typeof handleReserveClick === 'function') {
          console.log('DEBUG: Calling handleReserveClick from fallback');
          await handleReserveClick(event);
        } else {
          console.error('DEBUG: handleReserveClick function not found');
          alert('Booking system is currently unavailable. Please try again later.');
          if (button) {
            button.disabled = false;
            button.textContent = 'Reserve';
            button.setAttribute('data-clicked', 'false');
            button.classList.remove('bg-gray-500');
          }
        }
      } catch (error) {
        console.error('DEBUG: Error in reserve button fallback:', error);
        alert('There was an issue with your booking. Please try again.');
        
        const button = document.getElementById('reserve-btn');
        if (button) {
          button.disabled = false;
          button.textContent = 'Reserve';
          button.setAttribute('data-clicked', 'false');
          button.classList.remove('bg-gray-500');
        }
      }
    };
    
    // Function to clear any stale booking state
    function clearBookingState() {
        console.log('Clearing any stale booking state');
        // Reset localStorage booking flags
        localStorage.removeItem('bookingInProgress');
        localStorage.removeItem('bookingTimestamp');
        localStorage.removeItem('currentTransactionId');
        
        // Reset the reserve button if it exists
        const reserveBtn = document.getElementById('reserve-btn');
        if (reserveBtn) {
            reserveBtn.disabled = false;
            reserveBtn.textContent = 'Reserve';
            reserveBtn.classList.remove('bg-gray-500');
            reserveBtn.setAttribute('data-clicked', 'false');
        }
    }

    // Initialize user drawer
    initializeUserDrawer(auth, db);
    
    // Initialize bookings functionality
    initializeBookingsModal();
    
    // Clear any previous booking state when the page first loads
    clearBookingState();

    // Add event listener to reserve button
    document.addEventListener('DOMContentLoaded', () => {
        console.log('Setting up reserve button event listener');
        const reserveBtn = document.getElementById('reserve-btn');
        
        if (reserveBtn) {
            // Remove any existing click listeners to prevent duplicates
            reserveBtn.replaceWith(reserveBtn.cloneNode(true));
            
            // Get the fresh button reference after replacing
            const freshReserveBtn = document.getElementById('reserve-btn');
            
            // Reset any previous state that might be stuck
            freshReserveBtn.disabled = false;
            freshReserveBtn.textContent = 'Reserve';
            freshReserveBtn.classList.remove('bg-gray-500');
            freshReserveBtn.setAttribute('data-clicked', 'false');
            
            // Add new click listener with full production implementation
            freshReserveBtn.addEventListener('click', function(event) {
                console.log('DEBUG: Reserve button click detected');
                
                // Check if button was already clicked
                if (this.getAttribute('data-clicked') === 'true' || this.disabled) {
                    console.log('DEBUG: Button already clicked, preventing duplicate reservation');
                    event.preventDefault();
                    event.stopPropagation();
                    return false;
                }
                
                // Immediately disable the button and mark as clicked
                console.log('DEBUG: Reserve button clicked - disabling to prevent duplicates');
                this.setAttribute('data-clicked', 'true');
                this.disabled = true;
                this.textContent = 'Processing...';
                this.classList.add('bg-gray-500');
                
                try {
                    // Call the reservation handler with proper error handling
                    handleReserveClick(event)
                        .catch(error => {
                            console.error('Error in handle reserve click:', error);
                            // Reset button if there's an error
                            setTimeout(() => {
                                this.disabled = false;
                                this.setAttribute('data-clicked', 'false');
                                this.textContent = 'Reserve';
                                this.classList.remove('bg-gray-500');
                                alert('There was an issue with your reservation. Please try again.');
                                
                                // Clear booking flags
                                localStorage.removeItem('bookingInProgress');
                                localStorage.removeItem('bookingTimestamp');
                            }, 1000);
                        });
                } catch (error) {
                    console.error('Critical error in reserve button click handler:', error);
                    // Reset button immediately for synchronous errors
                    this.disabled = false;
                    this.setAttribute('data-clicked', 'false');
                    this.textContent = 'Reserve';
                    this.classList.remove('bg-gray-500');
                    alert('There was an issue with your reservation. Please try again.');
                }
                
                // Add safety timeout to re-enable button after 60 seconds if no response
                setTimeout(() => {
                    // Check if button is still disabled, indicating the process didn't complete
                    if (this.disabled && this.getAttribute('data-clicked') === 'true') {
                        console.log('Safety timeout: Re-enabling reserve button after 60s');
                        this.disabled = false;
                        this.setAttribute('data-clicked', 'false');
                        this.textContent = 'Reserve';
                        this.classList.remove('bg-gray-500');
                        
                        // Clear booking flags
                        localStorage.removeItem('bookingInProgress');
                        localStorage.removeItem('bookingTimestamp');
                    }
                }, 60000); // 60 seconds timeout
            });
            
            console.log('Attached production-ready event listener to reserve button');
        } else {
            console.error('Reserve button not found');
        }
        
        // Setup direct event handler for showBookingsBtn
        const showBookingsBtn = document.getElementById('showBookingsBtn');
        if (showBookingsBtn) {
            showBookingsBtn.addEventListener('click', () => {
                console.log('Show bookings button clicked directly');
                showBookingsModal();
                
                // Close the user drawer when showing bookings
                const userDrawer = document.getElementById('userDrawer');
                if (userDrawer) {
                    userDrawer.classList.add('translate-x-full');
                }
                
                // Hide overlay
                const drawerOverlay = document.getElementById('drawerOverlay');
                if (drawerOverlay) {
                    drawerOverlay.classList.add('hidden');
                }
            });
        }
    });

    // Add direct calendar setup function to ensure it works
    function setupCalendarPicker() {
      console.log('Setting up calendar picker functionality');
      const calendarModal = document.getElementById('calendar-modal');
      const checkInInput = document.getElementById('check-in-date');
      const checkOutInput = document.getElementById('check-out-date');
      const closeCalendarBtn = document.getElementById('close-calendar');
      const clearDatesBtn = document.getElementById('clear-dates');
      const prevMonthBtn = document.getElementById('prev-month');
      const nextMonthBtn = document.getElementById('next-month');
      const calendarGrid = document.getElementById('calendar-grid');
      const calendarMonth = document.getElementById('calendar-month');
      
      if (!calendarModal || !checkInInput || !checkOutInput) {
        console.error('Calendar elements not found');
        return;
      }

      // Current date for calendar rendering
      let currentDate = new Date();
      let selectedCheckIn = null;
      let selectedCheckOut = null;

      // Render calendar function
      function renderCalendar(date) {
        const month = date.getMonth();
        const year = date.getFullYear();
        
        calendarMonth.textContent = `${date.toLocaleString('default', { month: 'long' })} ${year}`;
        calendarGrid.innerHTML = '';

        // Weekday headers
        const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        weekdays.forEach(day => {
          const dayEl = document.createElement('div');
          dayEl.textContent = day;
          dayEl.className = 'text-xs font-medium text-gray-500';
          calendarGrid.appendChild(dayEl);
        });

        // Calculate first day of the month and last day
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startingDay = firstDay.getDay();

        // Add previous month's days
        for (let i = 0; i < startingDay; i++) {
          const dayEl = document.createElement('div');
          dayEl.textContent = new Date(year, month, -startingDay + i + 1).getDate();
          dayEl.className = 'text-gray-300';
          calendarGrid.appendChild(dayEl);
        }

        // Add current month's days
        for (let day = 1; day <= lastDay.getDate(); day++) {
          const dayEl = document.createElement('div');
          dayEl.textContent = day;
          dayEl.className = 'hover-date text-gray-500 hover:bg-blue-50 rounded py-2 cursor-pointer';
          
          const currentDay = new Date(year, month, day);

          // Check if day is in range
          if (selectedCheckIn && selectedCheckOut && 
              currentDay > selectedCheckIn && 
              currentDay < selectedCheckOut) {
            dayEl.classList.add('bg-blue-50', 'text-blue-600');
          }

          // Highlight selected dates
          if ((selectedCheckIn && currentDay.toDateString() === selectedCheckIn.toDateString()) ||
              (selectedCheckOut && currentDay.toDateString() === selectedCheckOut.toDateString())) {
            dayEl.classList.add('bg-blue-500', 'text-white');
          }

          dayEl.addEventListener('click', () => handleDateSelection(currentDay));
          calendarGrid.appendChild(dayEl);
        }
      }

      // Handle date selection
      function handleDateSelection(selectedDate) {
        if (!selectedCheckIn || (selectedCheckIn && selectedCheckOut)) {
          // First selection or reset
          selectedCheckIn = selectedDate;
          selectedCheckOut = null;
          checkInInput.value = formatDate(selectedDate);
          checkOutInput.value = '';
        } else {
          // Second selection
          if (selectedDate > selectedCheckIn) {
            selectedCheckOut = selectedDate;
            checkOutInput.value = formatDate(selectedDate);
            
            // Calculate nights for display
            const nights = Math.round((selectedCheckOut - selectedCheckIn) / (1000 * 60 * 60 * 24));
            document.getElementById('nights-selected').textContent = `${nights} night${nights > 1 ? 's' : ''}`;
            
            // Update price calculation if available
            if (typeof updatePriceCalculation === 'function') {
              updatePriceCalculation();
            }
            
            // Close calendar modal after selecting both dates
            setTimeout(() => {
              calendarModal.classList.add('hidden');
              calendarModal.classList.remove('flex');
            }, 500);
          } else {
            // If selected date is before check-in, reset and start over
            selectedCheckIn = selectedDate;
            selectedCheckOut = null;
            checkInInput.value = formatDate(selectedDate);
            checkOutInput.value = '';
          }
        }

        renderCalendar(currentDate);
      }

      // Format date for display
      function formatDate(date) {
        return date.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric', 
          year: 'numeric' 
        });
      }

      // Event listeners for check-in and check-out inputs
      checkInInput.addEventListener('click', () => {
        calendarModal.classList.remove('hidden');
        calendarModal.classList.add('flex');
        renderCalendar(currentDate);
      });

      checkOutInput.addEventListener('click', () => {
        if (selectedCheckIn) {
          calendarModal.classList.remove('hidden');
          calendarModal.classList.add('flex');
          renderCalendar(currentDate);
        }
      });

      // Close calendar modal
      closeCalendarBtn.addEventListener('click', () => {
        calendarModal.classList.add('hidden');
        calendarModal.classList.remove('flex');
      });

      // Clear dates
      clearDatesBtn.addEventListener('click', () => {
        selectedCheckIn = null;
        selectedCheckOut = null;
        checkInInput.value = '';
        checkOutInput.value = '';
        document.getElementById('nights-selected').textContent = '';
        renderCalendar(currentDate);
      });

      // Navigate months
      prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
      });

      nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
      });

      // Close calendar when clicking outside
      calendarModal.addEventListener('click', (e) => {
        if (e.target === calendarModal) {
          calendarModal.classList.add('hidden');
          calendarModal.classList.remove('flex');
        }
      });

      // Initialize calendar with current date
      renderCalendar(currentDate);
      console.log('Calendar picker setup complete');
    }

    document.addEventListener('DOMContentLoaded', function() {
      const userIcon = document.getElementById('userIconBtn');
      const userDrawer = document.getElementById('userDrawer');
      const closeDrawer = document.getElementById('closeDrawer');
      const drawerOverlay = document.getElementById('drawerOverlay');

      if (userIcon && userDrawer && closeDrawer && drawerOverlay) {
        // Open drawer
        userIcon.addEventListener('click', function() {
          userDrawer.classList.remove('translate-x-full');
          drawerOverlay.classList.remove('hidden');
        });
      
        // Close drawer
        closeDrawer.addEventListener('click', closeUserDrawer);
        drawerOverlay.addEventListener('click', closeUserDrawer);
      }
    
      function closeUserDrawer() {
        userDrawer.classList.add('translate-x-full');
        drawerOverlay.classList.add('hidden');
      }
    });

    // Gallery functionality
    const images = [
      '../components/6.jpg',
      '../components/7.jpg',
      '../components/8.jpg',
      '../components/9.jpg',
      '../components/10.jpg'
    ];
    
    let currentImageIndex = 0;
    
    window.openGallery = function(index) {
      currentImageIndex = index;
      document.getElementById('gallery-modal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      updateGalleryImage();
    }
    
    window.closeGallery = function() {
      document.getElementById('gallery-modal').classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
    
    window.prevImage = function() {
      currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
      updateGalleryImage();
    }
    
    window.nextImage = function() {
      currentImageIndex = (currentImageIndex + 1) % images.length;
      updateGalleryImage();
    }
    
    window.showImage = function(index) {
      currentImageIndex = index;
      updateGalleryImage();
    }
    
    function updateGalleryImage() {
      const galleryImage = document.getElementById('gallery-image');
      const counter = document.getElementById('gallery-counter');
      const thumbs = document.querySelectorAll('.gallery-thumb');
      
      galleryImage.src = images[currentImageIndex];
      counter.textContent = `${currentImageIndex + 1} / ${images.length}`;
      
      thumbs.forEach((thumb, index) => {
        if (index === currentImageIndex) {
          thumb.classList.add('ring-2', 'ring-blue-500');
        } else {
          thumb.classList.remove('ring-2', 'ring-blue-500');
        }
      });
    }

    import('../../AdminSide/firebase.js').then(({ auth }) => {
        auth.onAuthStateChanged((user) => {
            const loginButton = document.getElementById('loginButton');
            if (loginButton) {
                if (user) {
                    loginButton.style.display = 'none';
                } else {
                    loginButton.style.display = 'flex';
                }
            }
        });
    });
  </script>

  <!-- jQuery Date Picker Implementation -->
  <script>
    // Define global variables for date tracking
    let selectedCheckInDate = null;
    let selectedCheckOutDate = null;
    
    // Constants for rate calculation (fallback if module doesn't load)
    const STANDARD_RATE = 1300;
    const NIGHT_PROMO_RATE = 580;
    const SERVICE_FEE_PERCENTAGE = 0.14;
    
    // Define a global synchronization function that the module can override later
    window.syncDateVariables = function(checkInDate, checkOutDate) {
      console.log('Using placeholder syncDateVariables - module not loaded yet');
      // Store the values for later sync
      window._pendingSync = {
        checkInDate,
        checkOutDate
      };
      
      // Since module isn't loaded yet, use the jQuery implementation
      calculatePricingInJQuery();
    };

    // Helper function to safely call syncDateVariables
    function safeSyncDates() {
      try {
        // Always use the global syncDateVariables function
        window.syncDateVariables(selectedCheckInDate, selectedCheckOutDate);
        
        // Add additional time validation
        validateDateTimeCombination();
      } catch (e) {
        console.error('Error syncing date variables:', e);
        // Fallback to jQuery calculation if there's an error
        calculatePricingInJQuery();
      }
    }
    
    // Function to validate that check-out datetime is after check-in datetime
    function validateDateTimeCombination() {
      if (!selectedCheckInDate || !selectedCheckOutDate) return;
      
      const checkInTimeSelect = document.getElementById('check-in-time');
      const checkOutTimeSelect = document.getElementById('check-out-time');
      
      if (!checkInTimeSelect || !checkOutTimeSelect) return;
      
      const checkInTime = checkInTimeSelect.value;
      const checkOutTime = checkOutTimeSelect.value;
      
      if (!checkInTime || !checkOutTime) return;
      
      // Create full datetime objects with selected times
      const fullCheckInDate = new Date(selectedCheckInDate);
      const fullCheckOutDate = new Date(selectedCheckOutDate);
      
      // Set hours and minutes
      if (checkInTime) {
        const [hours, minutes] = checkInTime.split(':').map(Number);
        fullCheckInDate.setHours(hours, minutes, 0, 0);
      }
      
      if (checkOutTime) {
        const [hours, minutes] = checkOutTime.split(':').map(Number);
        fullCheckOutDate.setHours(hours, minutes, 0, 0);
      }
      
      // Check if the full datetime is valid (checkout after checkin)
      if (selectedCheckInDate.toDateString() === selectedCheckOutDate.toDateString() && 
          fullCheckOutDate <= fullCheckInDate) {
        // Show warning for same-day bookings with invalid times
        const errorModal = document.getElementById('reservation-error-modal');
        const errorMessage = document.getElementById('reservation-error-message');
        
        if (errorModal && errorMessage) {
          errorMessage.textContent = 'For same-day bookings, check-out time must be after check-in time';
          errorModal.classList.remove('hidden');
        } else {
          // Fallback to alert if modal not found
          alert('For same-day bookings, check-out time must be after check-in time');
        }
        
        // Reset checkout time
        checkOutTimeSelect.value = '';
      }
    }
    
    // Fallback jQuery implementation of price calculation
    function calculatePricingInJQuery() {
      if (!selectedCheckInDate) return;
      
      const nightsSelected = document.getElementById('nights-selected');
      const pricingDetails = document.getElementById('pricing-details');
      const nightsCalculation = document.getElementById('nights-calculation');
      const totalNightsPrice = document.getElementById('total-nights-price');
      const serviceFee = document.getElementById('service-fee');
      const totalPrice = document.getElementById('total-price');
      const promoDiscountRow = document.getElementById('promo-discount-row');
      const promoDiscount = document.getElementById('promo-discount');
      
      // If no elements found, bail out
      if (!pricingDetails || !nightsCalculation || !totalNightsPrice) {
        console.warn('Price calculation elements not found');
        return;
      }
      
      // Get check-in and check-out times
      const checkInTime = document.getElementById('check-in-time').value;
      const checkOutTime = document.getElementById('check-out-time').value;
      
      // Hourly mode
      const hourlyToggle = document.getElementById('hourly-toggle');
      const hourlyDuration = document.getElementById('hourly-duration');
      const isHourlyMode = hourlyToggle && hourlyToggle.checked;
      
      if (isHourlyMode) {
        // Handle hourly pricing here
        const hours = hourlyDuration ? parseInt(hourlyDuration.value) : 2;
        const hourlyRate = getHourlyRate(hours);
        const serviceFeeAmount = Math.round(hourlyRate * SERVICE_FEE_PERCENTAGE);
        const totalAmount = hourlyRate + serviceFeeAmount;
        
        if (nightsSelected) nightsSelected.textContent = `${hours} hours selected`;
        nightsCalculation.textContent = `â‚±${hourlyRate.toLocaleString()} for ${hours} hours`;
        totalNightsPrice.textContent = `â‚±${hourlyRate.toLocaleString()}`;
        
        if (promoDiscountRow) promoDiscountRow.classList.add('hidden');
        
        serviceFee.textContent = `â‚±${serviceFeeAmount.toLocaleString()}`;
        pricingDetails.classList.remove('hidden');
        totalPrice.textContent = `â‚±${totalAmount.toLocaleString()}`;
        return;
      }
      
      // If no check-out date, show base rate
      if (!selectedCheckOutDate) {
        const baseRate = 380;
        const serviceFeeAmount = Math.round(baseRate * SERVICE_FEE_PERCENTAGE);
        const totalAmount = baseRate + serviceFeeAmount;
        
        if (nightsSelected) nightsSelected.textContent = `Base rate`;
        nightsCalculation.textContent = `â‚±${baseRate.toLocaleString()} base rate`;
        totalNightsPrice.textContent = `â‚±${baseRate.toLocaleString()}`;
        
        if (promoDiscountRow) promoDiscountRow.classList.add('hidden');
        
        serviceFee.textContent = `â‚±${serviceFeeAmount.toLocaleString()}`;
        pricingDetails.classList.remove('hidden');
        totalPrice.textContent = `â‚±${totalAmount.toLocaleString()}`;
        return;
      }
      
      // Calculate nights
      const oneDay = 24 * 60 * 60 * 1000;
      const nights = Math.round(Math.abs((selectedCheckOutDate - selectedCheckInDate) / oneDay));
      
      if (nightsSelected) nightsSelected.textContent = `${nights} nights selected`;
      
      // Special handling for same-day bookings
      const isSameDay = selectedCheckInDate.getFullYear() === selectedCheckOutDate.getFullYear() && 
                       selectedCheckInDate.getMonth() === selectedCheckOutDate.getMonth() && 
                       selectedCheckInDate.getDate() === selectedCheckOutDate.getDate();
                       
      if (isSameDay) {
        // Parse hours to calculate duration
        let checkInHours = 14, checkOutHours = 12;
        
        try {
          if (checkInTime) {
            const [hours] = checkInTime.split(':').map(Number);
            checkInHours = hours;
          }
          
          if (checkOutTime) {
            const [hours] = checkOutTime.split(':').map(Number);
            checkOutHours = hours;
          }
        } catch (err) {
          console.warn('Error parsing time values:', err);
        }
        
        // Calculate duration (handle overnight case)
        let duration = checkOutHours >= checkInHours ? 
            checkOutHours - checkInHours : 
            (24 - checkInHours) + checkOutHours;
        
        // Minimum stay of 2 hours
        duration = Math.max(2, duration);
        
        // Calculate rate based on duration
        const hourlyRate = getHourlyRate(duration);
        const serviceFeeAmount = Math.round(hourlyRate * SERVICE_FEE_PERCENTAGE);
        const totalAmount = hourlyRate + serviceFeeAmount;
        
        if (nightsSelected) nightsSelected.textContent = `${duration} hours selected`;
        nightsCalculation.textContent = `â‚±${hourlyRate.toLocaleString()} for ${duration} hours`;
        totalNightsPrice.textContent = `â‚±${hourlyRate.toLocaleString()}`;
        
        if (promoDiscountRow) promoDiscountRow.classList.add('hidden');
        
        serviceFee.textContent = `â‚±${serviceFeeAmount.toLocaleString()}`;
        pricingDetails.classList.remove('hidden');
        totalPrice.textContent = `â‚±${totalAmount.toLocaleString()}`;
        return;
      }
      
      // For overnight stays
      // Check if eligible for night promo - one night stay with night promo times
      const isNightCheckIn = checkInTime === '22:00';
      const validCheckOutTimes = ['03:00', '04:00', '05:00', '06:00', '07:00', '08:00'];
      const isEarlyCheckOut = validCheckOutTimes.includes(checkOutTime);
      const isPromoEligible = nights === 1 && isNightCheckIn && isEarlyCheckOut;
      
      const promoBanner = document.getElementById('promo-banner');
      if (promoBanner) {
        promoBanner.classList.toggle('hidden', !isPromoEligible);
      }
      
      const nightPromoPopup = document.getElementById('night-promo-popup');
      if (nightPromoPopup) {
        nightPromoPopup.classList.toggle('hidden', !isPromoEligible);
      }
      
      // Calculate costs
      let nightlyRate, discountAmount = 0, subtotal;
      
      // Apply night promo rate if eligible
      if (isPromoEligible) {
        nightlyRate = NIGHT_PROMO_RATE;
        
        // Update the display
        const rateTypeDisplay = document.getElementById('rate-type-display');
        if (rateTypeDisplay) {
          rateTypeDisplay.textContent = 'Night Promo (â‚±580/night)';
          rateTypeDisplay.classList.remove('text-blue-700');
          rateTypeDisplay.classList.add('text-green-600');
        }
        
        const rateInfo = document.getElementById('rate-info');
        if (rateInfo) {
          rateInfo.textContent = 'Night promo rate applied! Check-in at 10:00 PM with check-out between 3:00 AM and 8:00 AM';
        }
        
        // Set hidden type value
        const hiddenInput = document.getElementById('rate-type-value');
        if (hiddenInput) hiddenInput.value = 'night-promo';
      } else {
        nightlyRate = STANDARD_RATE;
        
        // Update the display for standard rate
        const rateTypeDisplay = document.getElementById('rate-type-display');
        if (rateTypeDisplay) {
          rateTypeDisplay.textContent = 'Standard (â‚±1,300/night)';
          rateTypeDisplay.classList.remove('text-green-600');
          rateTypeDisplay.classList.add('text-blue-700');
        }
        
        const rateInfo = document.getElementById('rate-info');
        if (rateInfo) {
          rateInfo.textContent = nights > 1 ? 
            'Night promo rate only available for one-night stays' : 
            'Select check-in at 10:00 PM and check-out between 3:00 AM and 8:00 AM for night promo rate';
        }
        
        // Set hidden type value
        const hiddenInput = document.getElementById('rate-type-value');
        if (hiddenInput) hiddenInput.value = 'standard';
      }
      
      subtotal = nightlyRate * nights;
      
      // Weekly discount (10%)
      if (nights >= 7) {
        discountAmount = subtotal * 0.1;
        subtotal -= discountAmount;
      }
      
      const serviceFeeAmount = Math.round(subtotal * SERVICE_FEE_PERCENTAGE);
      const totalAmount = subtotal + serviceFeeAmount;
      
      // Update UI
      nightsCalculation.textContent = `â‚±${nightlyRate.toLocaleString()} x ${nights} nights`;
      totalNightsPrice.textContent = `â‚±${(nightlyRate * nights).toLocaleString()}`;
      
      // Show/hide discount row
      if (promoDiscountRow && promoDiscount) {
        if (discountAmount > 0) {
          promoDiscountRow.classList.remove('hidden');
          const description = nights >= 7 ? 'Weekly Discount' : 'Night Promo Discount';
          promoDiscountRow.querySelector('span:first-child').textContent = description;
          promoDiscount.textContent = `-â‚±${discountAmount.toLocaleString()}`;
        } else {
          promoDiscountRow.classList.add('hidden');
        }
      }
      
      serviceFee.textContent = `â‚±${serviceFeeAmount.toLocaleString()}`;
      pricingDetails.classList.remove('hidden');
      totalPrice.textContent = `â‚±${totalAmount.toLocaleString()}`;
    }
    
    // Fallback function to calculate hourly rate
    function getHourlyRate(hours) {
      if (hours <= 2) return 320;
      if (hours <= 3) return 380;
      if (hours <= 4) return 440;
      if (hours <= 5) return 500;
      if (hours <= 6) return 560;
      if (hours <= 7) return 620;
      if (hours <= 8) return 680;
      if (hours <= 9) return 740;
      if (hours <= 10) return 800;
      if (hours <= 11) return 820;
      if (hours <= 12) return 820;
      if (hours <= 13) return 880;
      return 940; // 14-24 hours
    }
    
    $(document).ready(function() {
      console.log('jQuery initialized');
      
      // Initialize check-in date picker
      $("#check-in-date").datepicker({
        dateFormat: "M d, yy",
        minDate: 0,
        changeMonth: true,
        changeYear: true,
        onSelect: function(dateText, inst) {
          selectedCheckInDate = $(this).datepicker('getDate');
          
          // Update check-out min date
          $("#check-out-date").datepicker("option", "minDate", selectedCheckInDate);
          
          // If check-out date is earlier than check-in, reset it
          const checkOutDate = $("#check-out-date").datepicker('getDate');
          if (checkOutDate && selectedCheckInDate > checkOutDate) {
            $("#check-out-date").val('');
            selectedCheckOutDate = null;
          }
          
          // If both dates are selected, calculate nights and update pricing
          if (selectedCheckInDate && selectedCheckOutDate) {
            updatePriceCalculation();
          }

          // Sync with module-level variables
          safeSyncDates();
        }
      });
      
      // Initialize check-out date picker
      $("#check-out-date").datepicker({
        dateFormat: "M d, yy",
        minDate: 0,
        changeMonth: true,
        changeYear: true,
        onSelect: function(dateText, inst) {
          selectedCheckOutDate = $(this).datepicker('getDate');
          
          // If check-in date is not selected, default to today
          if (!selectedCheckInDate) {
            selectedCheckInDate = new Date();
            $("#check-in-date").datepicker('setDate', selectedCheckInDate);
          }
          
          // Update pricing
          updatePriceCalculation();

          // Sync with module-level variables
          safeSyncDates();
        }
      });
      
      // Check every 500ms if we need to re-sync any pending changes after module loads
      const syncInterval = setInterval(() => {
        if (window._pendingSync) {
          // Try to use the real syncDateVariables
          try {
            // If the original syncDateVariables function has been replaced by the module version
            if (window.syncDateVariables.toString().includes('selectedCheckIn')) {
              console.log('Real syncDateVariables loaded, re-syncing pending dates');
              window.syncDateVariables(window._pendingSync.checkInDate, window._pendingSync.checkOutDate);
              window._pendingSync = null; // Clear after successful sync
              clearInterval(syncInterval); // Stop checking once synced
            }
          } catch (e) {
            console.warn('Still waiting for module to load syncDateVariables');
          }
        }
      }, 500);
      
      // Update time dropdowns to trigger promo check
      $('#check-in-time, #check-out-time').on('change', function() {
        if (selectedCheckInDate && selectedCheckOutDate) {
          safeSyncDates();
        }
      });
      
      // Hourly toggle functionality
      $('#hourly-toggle').on('change', function() {
        if ($(this).is(':checked')) {
          // Switch to hourly
          $('#hourly-options').removeClass('hidden');
          $('#rate-type-display').text('Hourly (â‚±320)').removeClass('text-blue-700 text-green-600').addClass('text-orange-600');
          $('#rate-info').text('Base rate: â‚±320 for 2 hours, with hourly rates based on duration');
          $('#rate-type-value').val('hourly');
        } else {
          // Switch to standard
          $('#hourly-options').addClass('hidden');
          $('#rate-type-display').text('Standard (â‚±1,300/night)').removeClass('text-orange-600 text-green-600').addClass('text-blue-700');
          $('#rate-info').text('Night promo rate (â‚±580) applied for one-night stays with check-in at 10PM and check-out between 3AM-8AM.');
          $('#rate-type-value').val('standard');
        }
        
        // Update pricing if dates are selected
        if (selectedCheckInDate && selectedCheckOutDate) {
          safeSyncDates();
        }
      });
      
      // Hourly duration change
      $('#hourly-duration').on('change', function() {
        // Update pricing
        if (selectedCheckInDate) {
          safeSyncDates();
        }
      });
      
      console.log('Date pickers initialized');
    });

    // Add a forwarding function to ensure updates are synchronized
    // This will call the module's updatePriceCalculation through syncDateVariables
    function updatePriceCalculation() {
      console.log('jQuery updatePriceCalculation called, forwarding to module via syncDateVariables');
      // Forward to the module implementation by syncing dates
      safeSyncDates();
    }
  </script>

  <!-- Reservation message modals -->
  <div id="reservation-error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-5 rounded-lg shadow-lg max-w-md w-full">
      <div class="flex items-center text-red-500 mb-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="text-lg font-bold">Reservation Error</h3>
      </div>
      <p id="reservation-error-message" class="mb-4"></p>
      <button class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 w-full close-modal">Close</button>
    </div>
  </div>

  <div id="reservation-success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white p-5 rounded-lg shadow-lg max-w-md w-full">
      <div class="flex items-center text-green-500 mb-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <h3 class="text-lg font-bold">Room Reserved!</h3>
      </div>
      <p id="reservation-success-message" class="mb-4">Your room has been successfully reserved.</p>
      <button id="proceed-to-payment" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 w-full">Proceed to Payment</button>
    </div>
  </div>

  <!-- Add emergency fallback script for the reserve button -->
  <script>
    // Standalone emergency fallback for reserve button in case all modules fail to load
    (function() {
      console.log('Setting up emergency reserve button fallback');
      
      // Only set up fallback if it doesn't already exist
      if (!window.emergencyReserveClickFallback) {
        window.emergencyReserveClickFallback = function(event) {
          console.log('EMERGENCY: Reserve button fallback activated');
          
          try {
            const button = event.target.closest('#reserve-btn');
            if (!button) {
              console.log('EMERGENCY: Button not found in event');
              return;
            }
            
            // Check if we have a contact number
            const contactNumber = document.getElementById('guest-contact')?.value;
            if (!contactNumber || contactNumber.length !== 11) {
              alert('Please enter a valid 11-digit contact number');
              return;
            }
            
            // Check if we have check-in dates
            const checkInDate = document.getElementById('check-in-date')?.value;
            if (!checkInDate) {
              alert('Please select a check-in date');
              return;
            }
            
            // Save emergency booking data to localStorage
            try {
              const emergencyBookingData = {
                checkInDate,
                checkOutDate: document.getElementById('check-out-date')?.value || '',
                checkInTime: document.getElementById('check-in-time')?.value || '',
                checkOutTime: document.getElementById('check-out-time')?.value || '',
                guests: document.getElementById('guests')?.value || '1',
                contactNumber,
                timestamp: new Date().toISOString(),
                isEmergencyBooking: true
              };
              
              localStorage.setItem('emergencyBookingData', JSON.stringify(emergencyBookingData));
              console.log('EMERGENCY: Saved booking data to localStorage');
              
              // Provide a way for the user to continue
              const confirmed = confirm(
                'Your reservation request has been saved locally. Please login and try again, or contact support for assistance. ' +
                'Would you like to proceed to login page?'
              );
              
              if (confirmed) {
                // Redirect to login
                window.location.href = '../Login/index.html?redirect=' + encodeURIComponent(window.location.href);
              }
            } catch (storageError) {
              console.error('EMERGENCY: Failed to save booking data:', storageError);
              alert('Unable to save your booking information. Please try again or contact support.');
            }
          } catch (error) {
            console.error('EMERGENCY: Error in reserve button fallback:', error);
            alert('An unexpected error occurred. Please try again or contact support.');
          }
        };
      }
      
      // Set up DOM content loaded handler to ensure button has a fallback
      document.addEventListener('DOMContentLoaded', function() {
        const reserveBtn = document.getElementById('reserve-btn');
        if (reserveBtn) {
          console.log('EMERGENCY: Found reserve button, adding inline click handler');
          
          // Add inline click handler as last resort
          reserveBtn.setAttribute('onclick', 
            "try { (window.reserveClickFallback || window.emergencyReserveClickFallback)(event); } catch(e) { console.error('All fallbacks failed:', e); alert('Reservation system is currently unavailable. Please try again later.'); }"
          );
        }
      });
    })();
  </script>
</body>
</html>
